<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('Minhas Squads - Task Management')}"></head>
<body class="dashboard-body">
<link rel="stylesheet" th:href="@{/css/squads.css}">

<!-- Sidebar -->
<nav th:replace="~{fragments/sidebar :: sidebar}"></nav>

<div class="main-content" id="mainContent">
    <div class="top-bar">
        <h1 class="page-title">
            <i class="bi bi-people-fill"></i> Minhas Squads
        </h1>
        <div class="user-info">
            <div th:replace="~{fragments/topbar-user-info :: userInfo}"></div>
        </div>
    </div>

    <div class="content-wrapper">
        <div th:replace="~{fragments/alerts :: alerts}"></div>

        <!-- Modern Page Header -->
        <div class="squad-page-header member-view">
          <div class="header-content">
            <div>
              <h2><i class="bi bi-people-fill"></i> Minhas Squads</h2>
              <p class="subtitle">
                <span th:text="${#lists.size(squads)}">0</span> squad(s) que você participa • Acompanhe as atividades do seu time
              </p>
            </div>
            <a th:href="@{/squads/invites}" class="btn-create">
              <i class="bi bi-envelope"></i> Ver Convites
            </a>
          </div>
        </div>

        <!-- Squads Grid -->
        <div class="squads-grid" th:unless="${#lists.isEmpty(squads)}">
          <div th:each="squad : ${squads}" class="squad-card" th:classappend="${!squad.active ? 'inactive' : ''}">
            <!-- Card Header -->
            <div class="squad-card-header">
              <span class="squad-type-badge" 
                    th:classappend="${squad.type?.name()?.toLowerCase() ?: 'fullstack'}"
                    th:text="${squad.type?.displayName ?: 'Fullstack'}">Tipo</span>
              <span class="squad-status-badge" th:classappend="${squad.active ? 'active' : 'inactive'}">
                <span class="status-dot"></span>
                <span th:text="${squad.active ? 'Ativa' : 'Inativa'}">Status</span>
              </span>
            </div>
            
            <!-- Card Body -->
            <div class="squad-card-body">
              <h3 class="squad-name" th:text="${squad.name}">Nome da Squad</h3>
              <p class="squad-description" th:text="${squad.description ?: 'Sem descrição disponível.'}">
                Descrição da squad...
              </p>
              
              <!-- Tech Stack Pills -->
              <div class="squad-tech-stack" th:if="${squad.techStack}">
                <span th:each="tech, iterStat : ${#strings.arraySplit(squad.techStack, ',')}" 
                      th:if="${iterStat.index < 4}">
                  <span class="tech-pill" th:text="${#strings.trim(tech)}">Tech</span>
                </span>
                <span class="tech-pill more" 
                      th:if="${#strings.arraySplit(squad.techStack, ',').length > 4}"
                      th:text="'+' + (${#strings.arraySplit(squad.techStack, ',').length} - 4)">+n</span>
              </div>

              <!-- Lead Info -->
              <div class="squad-lead-info">
                <div class="lead-avatar">
                  <img th:src="${squad.lead.profile?.avatarUrl != null ? squad.lead.profile.avatarUrl : '/images/avatar-placeholder.svg'}" 
                       alt="Lead" />
                </div>
                <div class="lead-details">
                  <span class="lead-label">Squad Lead</span>
                  <span class="lead-name" th:text="${squad.lead.fullName ?: squad.lead.username}">Lead Name</span>
                </div>
              </div>
              
              <!-- Goal -->
              <div class="squad-goal-card" th:if="${squad.goal}">
                <i class="bi bi-bullseye"></i>
                <div>
                  <span class="goal-label">Objetivo</span>
                  <span class="goal-text" th:text="${squad.goal}">Goal</span>
                </div>
              </div>

              <!-- Meta Info -->
              <div class="squad-meta">
                <div class="squad-meta-item">
                  <i class="bi bi-calendar-event"></i>
                  <span>Desde <span th:text="${#temporals.format(squad.createdAt, 'dd/MM/yyyy')}">Data</span></span>
                </div>
                <div class="squad-meta-item" th:if="${squad.maxMembers}">
                  <i class="bi bi-people"></i>
                  <span>Máx. <span th:text="${squad.maxMembers}">10</span></span>
                </div>
              </div>
            </div>
            
            <!-- Card Actions -->
            <div class="squad-card-actions">
              <a th:href="@{/squads/{id}/dashboard(id=${squad.id})}" 
                 class="squad-btn squad-btn-primary" th:if="${squad.active}">
                <i class="bi bi-speedometer2"></i> Dashboard
              </a>
              <a th:href="@{/ranking/squad/{id}(id=${squad.id})}" class="squad-btn squad-btn-secondary">
                <i class="bi bi-trophy"></i> Ranking
              </a>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="squad-empty-state" th:if="${#lists.isEmpty(squads)}">
          <div class="empty-icon">
            <i class="bi bi-people"></i>
          </div>
          <h4>Você ainda não participa de nenhuma squad</h4>
          <p>Aguarde um convite de um Lead ou Admin para participar de uma squad.</p>
          <a th:href="@{/squads/invites}" class="btn-create" style="display: inline-flex;">
            <i class="bi bi-envelope"></i> Ver Convites Pendentes
          </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script th:src="@{/js/sidebar.js}"></script>
<script th:src="@{/js/dashboard.js}"></script>

<!-- WebSocket Dependencies -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script th:src="@{/js/gamification-websocket.js}"></script>

<div th:replace="~{fragments/notifications :: notifications}"></div>
</body>
</html>
