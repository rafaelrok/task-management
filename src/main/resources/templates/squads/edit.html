<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/head :: head('Editar Squad - ' + ${squad.name})}"></head>
  <body class="dashboard-body">
    <link rel="stylesheet" th:href="@{/css/squads.css}">
    <nav th:replace="~{fragments/sidebar :: sidebar}"></nav>
    <div class="main-content">
      <div class="top-bar fixed">
        <h1 class="page-title">
          <i class="bi bi-pencil-square"></i> Editar Squad
        </h1>
        <div th:replace="~{fragments/topbar-user-info :: userInfo}"></div>
      </div>
      <div class="content-wrapper">
        <div th:replace="~{fragments/alerts :: alerts}"></div>
        
        <div class="form-container">
          <div class="form-card">
            <div class="form-header edit-mode">
              <div class="form-icon">
                <i class="bi bi-pencil-fill"></i>
              </div>
              <h3>Editar Squad</h3>
              <p th:text="${squad.name}">Nome da Squad</p>
            </div>
            
            <form th:action="@{/squads/{id}/edit(id=${squad.id})}" method="post" class="squad-form">
              
              <!-- Informações Básicas -->
              <div class="form-section">
                <h6 class="section-title">
                  <i class="bi bi-info-circle"></i> Informações Básicas
                </h6>
                
                <div class="form-row">
                  <div class="form-group flex-grow">
                    <label for="name" class="form-label">Nome da Squad *</label>
                    <input type="text" class="form-control" id="name" name="name" 
                           th:value="${squad.name}" required maxlength="100">
                  </div>
                  <div class="form-group" style="min-width: 180px;">
                    <label for="type" class="form-label">Tipo</label>
                    <select class="form-select" id="type" name="type">
                      <option th:each="squadType : ${squadTypes}" 
                              th:value="${squadType}" 
                              th:text="${squadType.displayName}"
                              th:selected="${squad.type == squadType}">Tipo</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="description" class="form-label">Descrição *</label>
                  <textarea class="form-control" id="description" name="description" 
                            rows="3" required maxlength="500" th:text="${squad.description}"></textarea>
                  <small class="form-hint">Máximo 500 caracteres</small>
                </div>
              </div>

              <!-- Detalhes Técnicos -->
              <div class="form-section">
                <h6 class="section-title">
                  <i class="bi bi-code-slash"></i> Detalhes Técnicos
                </h6>

                <div class="form-group">
                  <label for="techStack" class="form-label">Tech Stack</label>
                  <input type="text" class="form-control" id="techStack" name="techStack" 
                         th:value="${squad.techStack}" maxlength="500"
                         placeholder="Ex: Java, Spring Boot, PostgreSQL, React">
                  <small class="form-hint">Tecnologias utilizadas (separadas por vírgula)</small>
                </div>

                <div class="form-row">
                  <div class="form-group flex-grow">
                    <label for="businessArea" class="form-label">Área de Negócio</label>
                    <input type="text" class="form-control" id="businessArea" name="businessArea" 
                           th:value="${squad.businessArea}" maxlength="200"
                           placeholder="Ex: Pagamentos, E-commerce, CRM">
                  </div>
                  <div class="form-group" style="min-width: 180px;">
                    <label for="maxMembers" class="form-label">Máx. Membros</label>
                    <input type="number" class="form-control" id="maxMembers" name="maxMembers" 
                           th:value="${squad.maxMembers}" min="2" max="50"
                           placeholder="Ilimitado">
                  </div>
                </div>

                <div class="form-group">
                  <label for="goal" class="form-label">Meta / Objetivo</label>
                  <textarea class="form-control" id="goal" name="goal" 
                            rows="2" maxlength="1000" th:text="${squad.goal}"
                            placeholder="Qual é o objetivo principal desta squad?"></textarea>
                </div>
              </div>

              <!-- Botões de Ação -->
              <div class="form-actions">
                <a th:href="@{/squads/{id}(id=${squad.id})}" class="squad-btn squad-btn-secondary">
                  <i class="bi bi-arrow-left"></i> Cancelar
                </a>
                <div class="action-buttons">
                  <button type="button" class="squad-btn squad-btn-danger" 
                          data-bs-toggle="modal" data-bs-target="#deactivateModal" 
                          th:if="${squad.active}">
                    <i class="bi bi-pause-circle"></i> Desativar
                  </button>
                  <button type="submit" class="btn-create">
                    <i class="bi bi-check-lg"></i> Salvar Alterações
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Squad Statistics Card -->
          <div class="stats-card">
            <h6><i class="bi bi-graph-up"></i> Estatísticas da Squad</h6>
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-value" th:text="${memberCount ?: 0}">0</span>
                <span class="stat-label">Membros</span>
              </div>
              <div class="stat-item">
                <span class="stat-value" th:text="${#temporals.format(squad.createdAt, 'dd/MM/yy')}">Data</span>
                <span class="stat-label">Criação</span>
              </div>
              <div class="stat-item lead-stat">
                <span class="stat-value" th:text="${squad.lead?.fullName ?: squad.lead?.username}">Lead</span>
                <span class="stat-label">Squad Lead</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Desativação -->
    <div class="modal fade" id="deactivateModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
          <div class="modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none;">
            <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> Desativar Squad</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" style="padding: 1.5rem;">
            <p>Tem certeza que deseja desativar a squad <strong th:text="${squad.name}">Nome</strong>?</p>
            <div class="alert alert-warning" style="border-radius: 10px;">
              <ul class="mb-0 small">
                <li>Novos membros não poderão ser convidados</li>
                <li>Tasks existentes serão mantidas</li>
                <li>A squad pode ser reativada por um administrador</li>
              </ul>
            </div>
          </div>
          <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
            <button type="button" class="squad-btn squad-btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <form th:action="@{/squads/{id}/deactivate(id=${squad.id})}" method="post" class="d-inline">
              <button type="submit" class="squad-btn squad-btn-danger">
                <i class="bi bi-pause-circle"></i> Confirmar Desativação
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/sidebar.js}"></script>
  </body>
</html>
