<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Editar Perfil - Task Management')}"></head>
<body class="dashboard-body" data-editing="false">
    <!-- Sidebar -->
    <nav th:replace="~{fragments/sidebar :: sidebar}"></nav>

<div class="main-content" id="mainContent">
    <div class="top-bar">
        <h1 class="page-title">Perfil Profissional</h1>
        <div class="user-info">
            <button class="btn btn-outline" onclick="openGithubImportModal()" type="button">
                <i class="bi bi-github"></i> Importar do GitHub
            </button>
            <button class="btn btn-secondary" data-edit-visible onclick="cancelEditMode()" type="button">
                <i class="bi bi-x-circle"></i> Cancelar edição
            </button>
            <button class="btn btn-primary" data-view-visible onclick="enableEditMode()" type="button">
                <i class="bi bi-pencil"></i> Editar Perfil
            </button>
        </div>
    </div>

    <div class="content-wrapper">
        <div th:replace="~{fragments/alerts :: alerts}"></div>
        <div class="edit-hint" data-view-visible>
            Visualize suas informações abaixo. Clique em <strong>Editar Perfil</strong> para habilitar os campos e salvar novas alterações.
        </div>
        <div class="form-card profile-edit-wrapper" data-animate="fade-up"
             th:with="avatarEditPath=${#strings.isEmpty(profileForm.avatarUrl) ? '/images/avatar-placeholder.svg' : profileForm.avatarUrl}">
            <form enctype="multipart/form-data" id="profileForm" method="post" th:action="@{/profile}" th:object="${profileForm}">
                <input th:field="*{avatarUrl}" type="hidden"/>
                <!-- Hidden fields for GitHub data -->
                <input th:field="*{githubLogin}" type="hidden"/>
                <input th:field="*{githubName}" type="hidden"/>
                <input th:field="*{githubCompany}" type="hidden"/>
                <input th:field="*{twitterUsername}" type="hidden"/>
                <input th:field="*{hireable}" type="hidden"/>
                <input th:field="*{publicRepos}" type="hidden"/>
                <input th:field="*{publicGists}" type="hidden"/>
                <input th:field="*{followers}" type="hidden"/>
                <input th:field="*{following}" type="hidden"/>
                <input th:field="*{githubCreatedAt}" type="hidden"/>
                <input th:field="*{githubUpdatedAt}" type="hidden"/>
                <input data-tag-hidden="skills" th:field="*{skills}" type="hidden"/>
                <input data-tag-hidden="softSkills" th:field="*{softSkills}" type="hidden"/>

                <div class="profile-edit-sections">
                    <section class="profile-panel profile-panel--hero">
                        <div class="hero-avatar">
                            <img alt="Avatar" id="avatarPreview" th:src="@{${avatarEditPath}}"/>
                            <label class="btn btn-outline" data-edit-visible>
                                <i class="bi bi-upload"></i> Atualizar foto
                                <input accept="image/*" data-editable-field onchange="previewAvatar(event)" th:field="*{avatar}" type="file"/>
                            </label>
                        </div>
                        <div class="hero-details">
                            <p class="hero-badge">Perfil conectado</p>
                            <h2 th:text="${profileForm.fullName != null ? profileForm.fullName : 'Seu nome completo'}"></h2>
                            <p class="hero-subtitle">Sincronize suas informações profissionais com o GitHub para manter tudo atualizado automaticamente.</p>
                            <div class="hero-stats">
                                <div>
                                    <span>Repositórios</span>
                                    <strong data-hero-stat="repos"
                                            th:text="${profileForm.publicRepos != null ? profileForm.publicRepos : 0}">0</strong>
                                </div>
                                <div>
                                    <span>Seguidores</span>
                                    <strong data-hero-stat="followers"
                                            th:text="${profileForm.followers != null ? profileForm.followers : 0}">0</strong>
                                </div>
                                <div>
                                    <span>Seguindo</span>
                                    <strong data-hero-stat="following"
                                            th:text="${profileForm.following != null ? profileForm.following : 0}">0</strong>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="profile-panel">
                        <div class="profile-panel__header">
                            <h3><i class="bi bi-person-lines-fill"></i> Informações pessoais</h3>
                            <p>Esses dados ajudam colegas e recrutadores a identificarem você.</p>
                        </div>
                        <div class="profile-panel__grid two-columns">
                            <div class="form-group">
                                <label class="form-label">Nome completo</label>
                                <input class="form-control" data-editable-field placeholder="Seu nome" th:field="*{fullName}" type="text"/>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input class="form-control" data-editable-field placeholder="email@exemplo.com" th:field="*{email}" type="email"/>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Localização</label>
                                <input class="form-control" data-editable-field placeholder="Cidade, País" th:field="*{location}" type="text"/>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Disponibilidade</label>
                                <div class="select-wrapper">
                                    <select class="form-control" data-editable-field th:field="*{availability}">
                                        <option value="">Selecione...</option>
                                        <option value="FULL_TIME">Full Time</option>
                                        <option value="PART_TIME">Part Time</option>
                                        <option value="FREELANCE">Freelance</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="profile-panel">
                        <div class="profile-panel__header">
                            <h3><i class="bi bi-briefcase"></i> Perfil profissional</h3>
                            <p>Conte sobre sua senioridade, stack principal e experiências.</p>
                        </div>
                        <div class="profile-panel__grid two-columns">
                            <div class="form-group">
                                <label class="form-label">Profissão</label>
                                <input class="form-control" data-editable-field placeholder="Ex: Desenvolvedor Backend" th:field="*{profession}" type="text"/>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nível de experiência</label>
                                <div class="select-wrapper">
                                    <select class="form-control" data-editable-field th:field="*{experienceLevel}">
                                        <option value="">Selecione...</option>
                                        <option value="JUNIOR">Junior</option>
                                        <option value="MID">Pleno</option>
                                        <option value="SENIOR">Sênior</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stack principal</label>
                                <input class="form-control" data-editable-field placeholder="Ex: Java/Spring, Node/React" th:field="*{primaryStack}" type="text"/>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:1rem;">
                            <label class="form-label">Bio</label>
                            <textarea class="form-control" data-editable-field
                                      placeholder="Conte um pouco sobre você, seus valores e foco profissional."
                                      rows="4"
                                      th:field="*{bio}"></textarea>
                        </div>
                    </section>

                    <section class="profile-panel">
                        <div class="profile-panel__header">
                            <h3><i class="bi bi-lightning-charge"></i> Skills</h3>
                            <p>Adicione suas competências em formato de tags para facilitar a leitura.</p>
                        </div>
                        <div class="skills-dual-grid">
                            <div>
                                <label class="form-label">Hard skills</label>
                                <div class="tag-input" data-tag-input-wrapper="skills">
                                    <div class="tag-list" data-tag-list="skills"></div>
                                    <input class="tag-input-field" data-editable-field data-tag-input="skills" placeholder="Digite e pressione Enter" type="text"/>
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Soft skills</label>
                                <div class="tag-input" data-tag-input-wrapper="softSkills">
                                    <div class="tag-list" data-tag-list="softSkills"></div>
                                    <input class="tag-input-field" data-editable-field data-tag-input="softSkills" placeholder="Comunicação, Liderança..." type="text"/>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="profile-panel">
                        <div class="profile-panel__header">
                            <h3><i class="bi bi-link-45deg"></i> Presença digital</h3>
                            <p>Compartilhe os links onde podemos saber mais sobre você.</p>
                        </div>
                        <div class="profile-panel__grid two-columns">
                            <div class="form-group">
                                <label class="form-label"><i class="bi bi-globe"></i> Website</label>
                                <input class="form-control" data-editable-field placeholder="https://" th:field="*{websiteUrl}" type="url"/>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="bi bi-github"></i> GitHub</label>
                                <input class="form-control" data-editable-field placeholder="https://github.com/usuario" th:field="*{githubUrl}" type="url"/>
                                <small class="form-text">Use o botão "Importar do GitHub" para preencher os dados automaticamente.</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="bi bi-linkedin"></i> LinkedIn</label>
                                <input class="form-control" data-editable-field placeholder="https://linkedin.com/in/usuario" th:field="*{linkedinUrl}" type="url"/>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="form-actions" data-edit-visible>
                    <button class="btn btn-secondary" onclick="cancelEditMode()" type="button">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </button>
                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-check-circle"></i> Salvar alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Importação do GitHub -->
<div class="modal-overlay" id="githubImportModal">
    <div class="modal-card">
        <button class="modal-close" onclick="closeGithubImportModal()" type="button">&times;</button>
        <div class="modal-icon">
            <i class="bi bi-github"></i>
        </div>
        <h2 class="modal-title">Importar do GitHub</h2>
        <p class="modal-subtitle">Digite seu nome de usuário do GitHub para importar suas informações de perfil automaticamente.</p>
        <div class="form-group" style="margin-top: 1.5rem; text-align: left;">
            <label class="form-label" for="githubUsernameInput">Usuário do GitHub</label>
            <input class="form-control github-input" id="githubUsernameInput" 
                   placeholder="Ex: rafaelrok" type="text" 
                   onkeydown="if(event.key === 'Enter') { event.preventDefault(); confirmGithubImport(); }"/>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeGithubImportModal()" type="button">
                <i class="bi bi-x-circle"></i> Cancelar
            </button>
            <button class="btn btn-primary" onclick="confirmGithubImport()" type="button">
                <i class="bi bi-download"></i> Importar
            </button>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <script th:src="@{/js/sidebar.js}"></script>
    <script th:src="@{/js/profile-edit.js}"></script>
    <script th:src="@{/js/dashboard.js}"></script>
</body>
</html>
